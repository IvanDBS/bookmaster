#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ—Ö –ª–∏–Ω—Ç–µ—Ä–æ–≤ –≤ –ø—Ä–æ–µ–∫—Ç–µ BookMaster

echo "üîç –ó–∞–ø—É—Å–∫ –ª–∏–Ω—Ç–µ—Ä–æ–≤ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ BookMaster..."
echo ""

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd "$(dirname "$0")/.."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
if [ ! -f "docker-compose.dev.yml" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: –ù–µ –Ω–∞–π–¥–µ–Ω —Ñ–∞–π–ª docker-compose.dev.yml. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞."
    exit 1
fi

echo "üìÅ –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞: $(pwd)"
echo ""

# –ó–∞–ø—É—Å–∫ RuboCop –¥–ª—è –±—ç–∫–µ–Ω–¥–∞
echo "üîß –ó–∞–ø—É—Å–∫ RuboCop –¥–ª—è –±—ç–∫–µ–Ω–¥–∞..."
cd backend
if bundle exec rubocop app lib spec --autocorrect-all; then
    echo "‚úÖ RuboCop —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω"
else
    echo "‚ö†Ô∏è  RuboCop –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è–º–∏"
fi
echo ""

# –ó–∞–ø—É—Å–∫ ESLint –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
echo "üé® –ó–∞–ø—É—Å–∫ ESLint –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞..."
cd ../frontend
if npm run lint -- --fix; then
    echo "‚úÖ ESLint —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω"
else
    echo "‚ö†Ô∏è  ESLint –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è–º–∏"
fi
echo ""

# –ó–∞–ø—É—Å–∫ Prettier –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
echo "üíÖ –ó–∞–ø—É—Å–∫ Prettier –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞..."
if npm run format; then
    echo "‚úÖ Prettier —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω"
else
    echo "‚ö†Ô∏è  Prettier –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è–º–∏"
fi
echo ""

echo "üéâ –í—Å–µ –ª–∏–Ω—Ç–µ—Ä—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã!"
echo ""
echo "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:"
echo "   ‚Ä¢ RuboCop: –ü—Ä–æ–≤–µ—Ä–µ–Ω –±—ç–∫–µ–Ω–¥ (Ruby/Rails)"
echo "   ‚Ä¢ ESLint: –ü—Ä–æ–≤–µ—Ä–µ–Ω —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ (Vue.js/JavaScript)"
echo "   ‚Ä¢ Prettier: –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥"
echo ""
echo "üí° –°–æ–≤–µ—Ç: –ó–∞–ø—É—Å–∫–∞–π—Ç–µ —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞."
